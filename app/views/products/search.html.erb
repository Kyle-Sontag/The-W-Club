<h1>Search Results</h1>

<div class="card mb-4">
  <div class="card-body">
    <%= form_with url: search_path, method: :get, local: true, class: "row g-3" do |f| %>
      <div class="col-md-5">
        <%= f.label :query, "Search", class: "form-label" %>
        <%= f.text_field :query, value: params[:query], placeholder: "Search by name or description...", class: "form-control" %>
      </div>

      <div class="col-md-3">
        <%= f.label :category_id, "Category", class: "form-label" %>
        <%= f.select :category_id,
            options_from_collection_for_select(Category.all, :id, :name, params[:category_id]),
            { prompt: "All Categories" },
            { class: "form-select" } %>
      </div>

      <div class="col-md-2">
        <%= f.label :sort, "Sort by", class: "form-label" %>
        <%= f.select :sort,
            options_for_select([
              ['Name (A-Z)', 'name_asc'],
              ['Name (Z-A)', 'name_desc'],
              ['Price (Low to High)', 'price_asc'],
              ['Price (High to Low)', 'price_desc']
            ], params[:sort]),
            {},
            { class: "form-select" } %>
      </div>

      <div class="col-md-2 d-flex align-items-end">
        <%= f.submit "Search", class: "btn btn-primary w-100" %>
      </div>
    <% end %>
  </div>
</div>

<% if params[:query].present? || params[:category_id].present? %>
  <div class="alert alert-info">
    Found <%= @products.total_count %> products
    <% if params[:query].present? %>
      matching "<strong><%= params[:query] %></strong>"
    <% end %>
    <% if params[:category_id].present? %>
      <% category = Category.find_by(id: params[:category_id]) %>
      <% if category %>
        in <strong><%= category.name %></strong>
      <% end %>
    <% end %>
  </div>
<% end %>

<%= link_to "â† Back to Home", root_path, class: "btn btn-secondary mb-4" %>

<div class="row">
  <%= render partial: 'product_card', collection: @products, as: :product %>
</div>

<div class="d-flex justify-content-center my-4">
  <%= paginate @products, params: { query: params[:query], category_id: params[:category_id], sort: params[:sort] } %>
</div>

<% if @products.empty? %>
  <div class="alert alert-warning text-center">
    <h4>No products found</h4>
    <p>Try adjusting your search criteria</p>
  </div>
<% end %>